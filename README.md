# Page Modifier

AIã‚’æ´»ç”¨ã—ã¦Webãƒšãƒ¼ã‚¸ã®æ©Ÿèƒ½ã‚’æŸ”è»Ÿã«æ‹¡å¼µã§ãã‚‹Chrome Extension

## æ¦‚è¦

Page Modifierã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒƒãƒˆã§è¦æœ›ã‚’ä¼ãˆã‚‹ã ã‘ã§ã€Claude APIãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³JSONå®šç¾©ã‚’ç”Ÿæˆã—ã€Webãƒšãƒ¼ã‚¸ã«æ©Ÿèƒ½ã‚’è¿½åŠ ãƒ»å¤‰æ›´ãƒ»å‰Šé™¤ã§ãã‚‹Chromeæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯JSONå½¢å¼ã§å®šç¾©ã•ã‚Œã€DOMæ“ä½œã€ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ãªã©ã‚’å®£è¨€çš„ã«è¨˜è¿°ã—ã¾ã™ã€‚

## ä¸»è¦æ©Ÿèƒ½

- ğŸ¤– **AIé§†å‹•ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”Ÿæˆ**: Claude APIã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®šç¾©ã‚’è‡ªå‹•ç”Ÿæˆ
- ğŸ”§ **æŸ”è»Ÿãªæ‹¡å¼µ**: JSONå®šç¾©ã§DOMæ“ä½œã€ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ã‚’å®Ÿç¾
- ğŸ¨ **ç›´æ„Ÿçš„UI**: ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ã§ç°¡å˜ã«æ©Ÿèƒ½è¿½åŠ 
- ğŸ“¦ **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†**: ä½œæˆã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä¿å­˜ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå¯èƒ½
- ğŸ¯ **è¦ç´ é¸æŠ**: ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãªè¦ç´ é¸æŠUIã§CSSã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆ
- ğŸ” **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚«ã‚¹ã‚¿ãƒ JSã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã€XSSå¯¾ç­–
- ğŸ’¾ **Storage API**: ãƒšãƒ¼ã‚¸å›ºæœ‰/ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’MAIN Worldã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰åˆ©ç”¨å¯èƒ½
- ğŸŒ **Chrome Extension Match Pattern**: æŸ”è»Ÿãªãƒ‰ãƒ¡ã‚¤ãƒ³æŒ‡å®šã‚’ã‚µãƒãƒ¼ãƒˆ

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ“ãƒ«ãƒ‰**: Vite 5.4+ + @crxjs/vite-plugin
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React 18 + TypeScript 5.6 + Tailwind CSS 3.4
- **æ‹¡å¼µæ©Ÿèƒ½**: Chrome Extension Manifest V3
- **AIçµ±åˆ**: Anthropic Claude API (@anthropic-ai/sdk)
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod
- **ãƒ†ã‚¹ãƒˆ**: Vitest + @testing-library/react (jsdomç’°å¢ƒ)

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js v18ä»¥ä¸Š
- npm v9ä»¥ä¸Š
- Chrome browser

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼‰
npm run dev

# æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build
```

### Chromeæ‹¡å¼µæ©Ÿèƒ½ã¨ã—ã¦èª­ã¿è¾¼ã‚€

1. `npm run build` ã‚’å®Ÿè¡Œã—ã¦ãƒ“ãƒ«ãƒ‰
2. Chromeã§ `chrome://extensions/` ã‚’é–‹ã
3. ã€Œãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹åŒ–
4. ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `dist/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠ

## é–‹ç™º

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
page_modifier/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ background/           # Service Worker
â”‚   â”‚   â”œâ”€â”€ service-worker.ts # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ plugin-store.ts   # chrome.storageæ“ä½œ
â”‚   â”œâ”€â”€ content/              # Content Scripts
â”‚   â”‚   â”œâ”€â”€ content-script.ts # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ plugin-engine.ts  # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â”œâ”€â”€ element-selector.ts # è¦ç´ é¸æŠUI
â”‚   â”‚   â”œâ”€â”€ event-manager.ts  # ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ main-world-script.ts # MAIN Worldå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â””â”€â”€ notification-utils.ts
â”‚   â”œâ”€â”€ sidepanel/            # Side Panel UI
â”‚   â”‚   â”œâ”€â”€ App.tsx           # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ components/       # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ NavigationBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatView.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PluginManagementView.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ services/         # Claude APIçµ±åˆ
â”‚   â”œâ”€â”€ shared/               # å…±æœ‰å‹å®šç¾©ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ types.ts          # å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ plugin-schema.ts  # Zodã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ validator.ts      # ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚   â”œâ”€â”€ chat-types.ts     # ãƒãƒ£ãƒƒãƒˆå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ storage-types.ts  # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‹å®šç¾©
â”‚   â””â”€â”€ utils/                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ plugin-utils.ts
â”‚       â”œâ”€â”€ uuid.ts
â”‚       â”œâ”€â”€ errors.ts
â”‚       â””â”€â”€ logger.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                 # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ background/
â”‚   â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”œâ”€â”€ fixtures/             # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ setup.ts
â”œâ”€â”€ public/
â”‚   â””â”€â”€ icons/                # ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ
â””â”€â”€ plugins/                  # ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
    â”œâ”€â”€ enhanced-toolbar.json
    â””â”€â”€ simple-copy-button.json
```

### ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆwatch modeï¼‰
npm test

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
npm run test:unit

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run test:coverage
```

**ãƒ†ã‚¹ãƒˆå®Ÿè£…çŠ¶æ³:**
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¹ã‚­ãƒ¼ãƒã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (`plugin-schema.test.ts`)
- âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚° (`plugin-schema-domain.test.ts`)
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`plugin-utils.test.ts`)
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ (`plugin-store.test.ts`)
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ (`plugin-engine.test.ts`)
- âœ… è¦ç´ ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ (`element-selector.test.ts`)
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (`event-manager.test.ts`)
- âœ… Claude APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (`claude-api-client.test.ts`)

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³JSONå½¢å¼

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®æ§‹é€ ã‚’æŒã¤JSONå®šç¾©ã§ã™ï¼š

```typescript
interface Plugin {
  id: string;                  // UUIDå½¢å¼
  name: string;                // è¡¨ç¤ºå
  version: string;             // semverå½¢å¼
  description?: string;        // èª¬æ˜
  targetDomains: string[];     // Chrome Extension Match Patternå½¢å¼
  enabled: boolean;            // æœ‰åŠ¹åŒ–ãƒ•ãƒ©ã‚°
  operations: Operation[];     // æ“ä½œã®é…åˆ—
}
```

**æ“ä½œã‚¿ã‚¤ãƒ—:**
- `insert`: æ–°ã—ã„è¦ç´ ã‚’æŒ¿å…¥
- `update`: æ—¢å­˜è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»å±æ€§ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
- `delete`: è¦ç´ ã‚’å‰Šé™¤
- `execute`: ã‚«ã‚¹ã‚¿ãƒ JavaScriptã‚’å®Ÿè¡Œ

è©³ç´°ã¯ [CLAUDE.md](./CLAUDE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chrome Extension                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚  Side Panel (React)                      â”‚
â”‚  â”œâ”€ Chat UI                              â”‚
â”‚  â”‚  â””â”€ Claude APIçµ±åˆ                    â”‚
â”‚  â””â”€ Plugin Management UI                 â”‚
â”‚                                           â”‚
â”‚  Background Service Worker               â”‚
â”‚  â”œâ”€ Plugin Storage (chrome.storage)     â”‚
â”‚  â””â”€ Message Router                       â”‚
â”‚                                           â”‚
â”‚  Content Script (å„Webãƒšãƒ¼ã‚¸ã«æ³¨å…¥)      â”‚
â”‚  â”œâ”€ Plugin Engine                        â”‚
â”‚  â”œâ”€ Element Selector                     â”‚
â”‚  â”œâ”€ Event Manager                        â”‚
â”‚  â””â”€ Main World Script (CSPå›é¿)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT

## å‚è€ƒæƒ…å ±

- [Chrome Extension Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)
- [Anthropic Claude API](https://docs.anthropic.com/)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆCLAUDE.md](./CLAUDE.md) - Claude Codeå‘ã‘ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
